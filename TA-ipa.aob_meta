{"basic_builder": {"appname": "TA-ipa", "friendly_name": "IPA", "version": "1.0.0", "author": "Rafael Ledezma", "description": "Collects Users, Hosts, DNS zones/records, Certs, Groups, HBAC, and RBAC from Red Hat IdM/FreeIPA", "theme": "#4fa484", "large_icon": "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", "small_icon": "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", "visible": false, "tab_version": "4.5.1", "tab_build_no": "0", "build_no": 2}, "data_input_builder": {"datainputs": [{"index": "default", "sourcetype": "idm:json", "interval": "30", "use_external_validation": true, "streaming_mode_xml": true, "name": "idm", "title": "IDM", "description": "", "type": "customized", "parameters": [{"name": "object_type", "label": "object_type", "help_string": "Select what data you want to bring in.", "required": true, "possible_values": [{"value": "users", "label": "Users"}, {"value": "hosts", "label": "Hosts"}, {"value": "dns", "label": "DNS"}, {"label": "Certs", "value": "certs"}, {"label": "Groups", "value": "groups"}, {"label": "HBAC", "value": "hbac"}, {"label": "RBAC", "value": "rbac"}], "format_type": "dropdownlist", "default_value": "users", "placeholder": "", "type": "dropdownlist", "value": "hosts"}, {"name": "global_account", "label": "Global Account", "help_string": "", "required": true, "possible_values": [], "format_type": "global_account", "default_value": "", "placeholder": "", "type": "global_account", "value": "account0"}], "data_inputs_options": [{"type": "customized_var", "name": "object_type", "title": "object_type", "description": "Select what data you want to bring in.", "required_on_edit": false, "required_on_create": true, "possible_values": [{"value": "users", "label": "Users"}, {"value": "hosts", "label": "Hosts"}, {"value": "dns", "label": "DNS"}, {"label": "Certs", "value": "certs"}, {"label": "Groups", "value": "groups"}, {"label": "HBAC", "value": "hbac"}, {"label": "RBAC", "value": "rbac"}], "format_type": "dropdownlist", "default_value": "users", "placeholder": ""}, {"type": "customized_var", "name": "global_account", "title": "Global Account", "description": "", "required_on_edit": false, "required_on_create": true, "possible_values": [], "format_type": "global_account", "default_value": "", "placeholder": ""}], "code": "# encoding: utf-8\nimport json, time, requests, calendar, re, base64, hashlib\nfrom pathlib import Path\n\n# ---------------------------\n# AOB entrypoints\n# ---------------------------\ndef validate_input(helper, definition):\n    ot = (definition.parameters.get(\"object_type\") or \"\").lower()\n    if ot not in (\"users\", \"hosts\", \"dns\", \"certs\", \"groups\", \"hbac\", \"rbac\"):\n        raise ValueError(\"object_type must be users|hosts|dns|certs|groups|hbac|rbac\")\n\ndef use_single_instance_mode():\n    return False\n\n# ---------------------------\n# Utilities\n# ---------------------------\ndef _resolve_verify(helper):\n    # Prefer CA file path if provided; else bool verify_ssl\n    ca = (helper.get_global_setting(\"ca_cert_path\") or \"\").strip()\n    if ca:\n        p = Path(ca)\n        if p.exists():\n            return str(p)\n        helper.log_warning(\"ca_cert_path not found: {}\".format(ca))\n    return str(helper.get_global_setting(\"verify_ssl\") or \"\").lower() == \"true\"\n\ndef _emit_records(helper, ew, base_url, object_type, results):\n    now = int(time.time())\n    for rec in results:\n        ew.write_event(helper.new_event(\n            sourcetype=\"idm:json\",\n            time=now,\n            data=json.dumps({\n                \"idm_server\": base_url,\n                \"object_type\": object_type,\n                \"record\": rec\n            })\n        ))\n\ndef _first(v):\n    if isinstance(v, list) and v:\n        return v[0]\n    return v\n\ndef _gtime_to_epoch(s):\n    # Parse LDAP GeneralizedTime like 20251103204231Z -> epoch (UTC)\n    try:\n        if isinstance(s, list):\n            s = s[0]\n        if isinstance(s, (int, float)):\n            return int(s)\n        if isinstance(s, str) and s.endswith(\"Z\"):\n            t = time.strptime(s, \"%Y%m%d%H%M%SZ\")\n            return int(calendar.timegm(t))\n    except Exception:\n        return None\n    return None\n\ndef _dnsname(v):\n    v = _first(v)\n    if isinstance(v, dict) and \"__dns_name__\" in v:\n        return v[\"__dns_name__\"]\n    return v\n\ndef _emit_dns_record_events(helper, ew, base_url, zone, recs):\n    now = int(time.time())\n    for rec in recs:\n        name = _dnsname(rec.get(\"idnsname\"))\n        if not name:\n            continue\n        fqdn = name if name.endswith(\".\") else f\"{name}.{zone}\"\n        rr_map, rr_types = {}, []\n        for k, v in rec.items():\n            if k in (\"idnsname\", \"objectclass\", \"dn\"):\n                continue\n            rr_map[k] = v\n            rr_types.append(k)\n\n        ew.write_event(helper.new_event(\n            sourcetype=\"idm:json\",\n            time=now,\n            data=json.dumps({\n                \"idm_server\": base_url,\n                \"object_type\": \"dns_record\",\n                \"zone\": zone,\n                \"name\": name,\n                \"fqdn\": fqdn,\n                \"rr_types\": rr_types,\n                \"rrdata\": rr_map,\n                \"record\": rec\n            })\n        ))\n\n# ---------------------------\n# Main collector\n# ---------------------------\ndef collect_events(helper, ew):\n    # Global settings\n    base_url = (helper.get_global_setting(\"base_url\") or \"\").strip()\n    if not base_url:\n        helper.log_error(\"Missing base_url in Global settings\")\n        return\n    if not base_url.startswith(\"http\"):\n        base_url = \"https://\" + base_url\n\n    verify = _resolve_verify(helper)\n\n    # Global account\n    acct = helper.get_arg(\"global_account\") or {}\n    username = acct.get(\"username\")\n    password = acct.get(\"password\")\n    if not username or not password:\n        helper.log_error(\"Missing Global Account. Configure it on the add-on's Configuration page.\")\n        return\n\n    # Input params\n    object_type = (helper.get_arg(\"object_type\") or \"users\").lower()\n    if object_type not in (\"users\", \"hosts\", \"dns\", \"certs\", \"groups\", \"hbac\", \"rbac\"):\n        helper.log_error(\"Bad object_type: {}\".format(object_type))\n        return\n\n    helper.log_info(\"START url={} verify={} object_type={}\".format(base_url, verify, object_type))\n\n    s = requests.Session()\n\n    # 1) Login\n    try:\n        r = s.post(f\"{base_url}/ipa/session/login_password\",\n                   data={\"user\": username, \"password\": password},\n                   headers={\"Referer\": base_url + \"/ipa\",\n                            \"Accept\": \"text/plain\",\n                            \"Content-Type\": \"application/x-www-form-urlencoded\"},\n                   verify=verify, timeout=30)\n        helper.log_info(\"LOGIN status={}\".format(r.status_code))\n    except Exception as e:\n        helper.log_error(\"LOGIN_EX: {}\".format(repr(e)))\n        return\n\n    # 2) env (API version)\n    try:\n        r = s.post(f\"{base_url}/ipa/session/json\",\n                   json={\"method\": \"env\", \"params\": [[], {}], \"id\": 0},\n                   headers={\"Referer\": base_url + \"/ipa\",\n                            \"Accept\": \"application/json\",\n                            \"Content-Type\": \"application/json\"},\n                   verify=verify, timeout=30)\n        env = r.json()\n        if env.get(\"error\") not in (None,):\n            helper.log_error(\"ENV_ERR: {}\".format(json.dumps(env[\"error\"])))\n            return\n        api_version = env[\"result\"][\"result\"].get(\"api_version\") or env[\"result\"].get(\"version\")\n        helper.log_info(\"ENV api_version={}\".format(api_version))\n    except Exception as e:\n        helper.log_error(\"ENV_EX: {}\".format(repr(e)))\n        return\n\n    # 3) Dispatch by object_type\n    if object_type == \"users\":\n        payload = {\"method\": \"user_find\",\n                   \"params\": [[\"\"], {\"all\": True, \"sizelimit\": 0, \"version\": api_version}],\n                   \"id\": 1}\n\n        try:\n            r = s.post(f\"{base_url}/ipa/session/json\",\n                       json=payload,\n                       headers={\"Referer\": base_url + \"/ipa\",\n                                \"Accept\": \"application/json\",\n                                \"Content-Type\": \"application/json\"},\n                       verify=verify, timeout=120)\n            resp = r.json()\n            if resp.get(\"error\") not in (None,):\n                helper.log_error(\"RPC_ERR(users): {}\".format(json.dumps(resp[\"error\"])))\n                return\n            results = resp.get(\"result\", {}).get(\"result\", [])\n            helper.log_info(\"RPC_OK type=users count={}\".format(len(results)))\n            _emit_records(helper, ew, base_url, \"users\", results)\n        except Exception as e:\n            helper.log_error(\"RPC_EX(users): {}\".format(repr(e)))\n            return\n\n    elif object_type == \"hosts\":\n        payload = {\"method\": \"host_find\",\n                   \"params\": [[\"\"], {\"all\": True, \"sizelimit\": 0, \"version\": api_version}],\n                   \"id\": 2}\n\n        try:\n            r = s.post(f\"{base_url}/ipa/session/json\",\n                       json=payload,\n                       headers={\"Referer\": base_url + \"/ipa\",\n                                \"Accept\": \"application/json\",\n                                \"Content-Type\": \"application/json\"},\n                       verify=verify, timeout=120)\n            resp = r.json()\n            if resp.get(\"error\") not in (None,):\n                helper.log_error(\"RPC_ERR(hosts): {}\".format(json.dumps(resp[\"error\"])))\n                return\n            results = resp.get(\"result\", {}).get(\"result\", [])\n            helper.log_info(\"RPC_OK type=hosts count={}\".format(len(results)))\n            _emit_records(helper, ew, base_url, \"hosts\", results)\n        except Exception as e:\n            helper.log_error(\"RPC_EX(hosts): {}\".format(repr(e)))\n            return\n\n    elif object_type == \"dns\":\n        # Zones\n        z_payload = {\"method\": \"dnszone_find\",\n                     \"params\": [[\"\"], {\"all\": True, \"sizelimit\": 0, \"version\": api_version}],\n                     \"id\": 300}\n        try:\n            zr = s.post(f\"{base_url}/ipa/session/json\",\n                        json=z_payload,\n                        headers={\"Referer\": base_url + \"/ipa\",\n                                 \"Accept\": \"application/json\",\n                                 \"Content-Type\": \"application/json\"},\n                        verify=verify, timeout=120)\n            zdata = zr.json()\n            if zdata.get(\"error\") not in (None,):\n                helper.log_error(\"DNS zones rpc error={}\".format(json.dumps(zdata[\"error\"])))\n                return\n            zones = zdata.get(\"result\", {}).get(\"result\", [])\n            helper.log_info(\"DNS zones: {}\".format(len(zones)))\n            _emit_records(helper, ew, base_url, \"dns_zone\", zones)\n        except Exception as e:\n            helper.log_error(\"DNS_ZONE_RPC_EX: {}\".format(repr(e)))\n            return\n\n        # Records per zone\n        for z in zones:\n            zone = _dnsname(z.get(\"idnsname\"))\n            if not zone:\n                continue\n            r_payload = {\"method\": \"dnsrecord_find\",\n                         \"params\": [[zone], {\"all\": True, \"sizelimit\": 0, \"version\": api_version}],\n                         \"id\": 301}\n            try:\n                rr = s.post(f\"{base_url}/ipa/session/json\",\n                            json=r_payload,\n                            headers={\"Referer\": base_url + \"/ipa\",\n                                     \"Accept\": \"application/json\",\n                                     \"Content-Type\": \"application/json\"},\n                            verify=verify, timeout=180)\n                rdata = rr.json()\n                if rdata.get(\"error\") not in (None,):\n                    helper.log_warning(\"DNS records error zone={}: {}\".format(zone, json.dumps(rdata[\"error\"])))\n                    continue\n                recs = rdata.get(\"result\", {}).get(\"result\", [])\n                helper.log_info(\"DNS records zone={} count={}\".format(zone, len(recs)))\n                _emit_dns_record_events(helper, ew, base_url, zone, recs)\n            except Exception as e:\n                helper.log_error(\"DNS_RECORD_EX zone={}: {}\".format(zone, repr(e)))\n                continue\n\n        helper.log_info(\"DNS enumeration DONE\")\n        return\n\n    elif object_type == \"groups\":\n        payload = {\"method\": \"group_find\",\n                   \"params\": [[\"\"], {\"all\": True, \"sizelimit\": 0, \"version\": api_version}],\n                   \"id\": 10}\n        try:\n            r = s.post(f\"{base_url}/ipa/session/json\",\n                       json=payload,\n                       headers={\"Referer\": base_url + \"/ipa\",\n                                \"Accept\": \"application/json\",\n                                \"Content-Type\": \"application/json\"},\n                       verify=verify, timeout=180)\n            resp = r.json()\n            if resp.get(\"error\") not in (None,):\n                helper.log_error(\"RPC_ERR(groups): {}\".format(json.dumps(resp[\"error\"])))\n                return\n            results = resp.get(\"result\", {}).get(\"result\", [])\n            helper.log_info(\"RPC_OK type=groups count={}\".format(len(results)))\n            _emit_records(helper, ew, base_url, \"groups\", results)\n        except Exception as e:\n            helper.log_error(\"RPC_EX(groups): {}\".format(repr(e)))\n            return\n\n    elif object_type == \"hbac\":\n        def _rpc(method, pid):\n            r = s.post(f\"{base_url}/ipa/session/json\",\n                       json={\"method\": method, \"params\": [[\"\"], {\"all\": True, \"sizelimit\": 0, \"version\": api_version}], \"id\": pid},\n                       headers={\"Referer\": base_url + \"/ipa\",\n                                \"Accept\": \"application/json\",\n                                \"Content-Type\": \"application/json\"},\n                       verify=verify, timeout=180)\n            j = r.json()\n            if j.get(\"error\") not in (None,):\n                helper.log_warning(f\"RPC_WARN({method}): {json.dumps(j['error'])}\")\n                return []\n            return j.get(\"result\", {}).get(\"result\", []) or []\n\n        rules = _rpc(\"hbacrule_find\", 20)\n        svcs  = _rpc(\"hbacsvc_find\", 21)\n        svcg  = _rpc(\"hbacsvcgroup_find\", 22)\n\n        helper.log_info(f\"HBAC rules={len(rules)} svcs={len(svcs)} svcgroups={len(svcg)}\")\n        _emit_records(helper, ew, base_url, \"hbac_rule\", rules)\n        _emit_records(helper, ew, base_url, \"hbac_service\", svcs)\n        _emit_records(helper, ew, base_url, \"hbac_servicegroup\", svcg)\n        return\n\n    elif object_type == \"rbac\":\n        def _rpc(method, pid):\n            r = s.post(f\"{base_url}/ipa/session/json\",\n                       json={\"method\": method, \"params\": [[\"\"], {\"all\": True, \"sizelimit\": 0, \"version\": api_version}], \"id\": pid},\n                       headers={\"Referer\": base_url + \"/ipa\",\n                                \"Accept\": \"application/json\",\n                                \"Content-Type\": \"application/json\"},\n                       verify=verify, timeout=180)\n            j = r.json()\n            if j.get(\"error\") not in (None,):\n                helper.log_warning(f\"RPC_WARN({method}): {json.dumps(j['error'])}\")\n                return []\n            return j.get(\"result\", {}).get(\"result\", []) or []\n\n        roles = _rpc(\"role_find\",       30)\n        privs = _rpc(\"privilege_find\",  31)\n        perms = _rpc(\"permission_find\", 32)\n\n        helper.log_info(f\"RBAC roles={len(roles)} privileges={len(privs)} permissions={len(perms)}\")\n        _emit_records(helper, ew, base_url, \"rbac_role\", roles)\n        _emit_records(helper, ew, base_url, \"rbac_privilege\", privs)\n        _emit_records(helper, ew, base_url, \"rbac_permission\", perms)\n        return\n\n    else:  # certs\n        payload = {\"method\": \"cert_find\",\n                   \"params\": [[], {\"all\": True, \"sizelimit\": 0, \"version\": api_version}],\n                   \"id\": 4}\n\n        try:\n            r = s.post(f\"{base_url}/ipa/session/json\",\n                       json=payload,\n                       headers={\"Referer\": base_url + \"/ipa\",\n                                \"Accept\": \"application/json\",\n                                \"Content-Type\": \"application/json\"},\n                       verify=verify, timeout=180)\n            resp = r.json()\n            if resp.get(\"error\") not in (None,):\n                helper.log_error(\"RPC_ERR(certs): {}\".format(json.dumps(resp[\"error\"])))\n                return\n            results = resp.get(\"result\", {}).get(\"result\", [])\n            helper.log_info(\"RPC_OK type=certs count={}\".format(len(results)))\n            _emit_records(helper, ew, base_url, \"certs\", results)\n        except Exception as e:\n            helper.log_error(\"RPC_EX(certs): {}\".format(repr(e)))\n            return\n\n        # Normalized cert summaries\n        now = int(time.time())\n        for rec in results:\n            serial = _first(rec.get(\"serial_number\") or rec.get(\"serial\") or rec.get(\"serialno\"))\n            subject = _first(rec.get(\"subject\"))\n            issuer  = _first(rec.get(\"issuer\"))\n            status  = _first(rec.get(\"status\")) or _first(rec.get(\"revoked\"))\n            not_after_raw  = _first(rec.get(\"valid_not_after\")  or rec.get(\"not_after\")  or rec.get(\"validity_end\"))\n            not_before_raw = _first(rec.get(\"valid_not_before\") or rec.get(\"not_before\") or rec.get(\"validity_start\"))\n            not_after_epoch  = _gtime_to_epoch(not_after_raw)\n            not_before_epoch = _gtime_to_epoch(not_before_raw)\n            not_after_iso  = time.strftime(\"%Y-%m-%d %H:%M:%S\", time.gmtime(not_after_epoch)) if not_after_epoch else None\n            not_before_iso = time.strftime(\"%Y-%m-%d %H:%M:%S\", time.gmtime(not_before_epoch)) if not_before_epoch else None\n            days_left = round((not_after_epoch - now)/86400, 1) if not_after_epoch else None\n\n            ew.write_event(helper.new_event(\n                sourcetype=\"idm:json\",\n                time=now,\n                data=json.dumps({\n                    \"idm_server\": base_url,\n                    \"object_type\": \"certs\",\n                    \"cert_summary\": {\n                        \"serial\": serial,\n                        \"subject\": subject,\n                        \"issuer\": issuer,\n                        \"status\": status,\n                        \"not_before_raw\": not_before_raw,\n                        \"not_after_raw\":  not_after_raw,\n                        \"not_before_epoch\": not_before_epoch,\n                        \"not_after_epoch\":  not_after_epoch,\n                        \"not_before_iso\":   not_before_iso,\n                        \"not_after_iso\":    not_after_iso,\n                        \"days_left\":        days_left\n                    },\n                    \"record\": rec\n                })\n            ))\n\n    helper.log_info(\"DONE\")\n", "customized_options": [{"name": "object_type", "value": "rbac"}, {"name": "global_account", "value": "account0"}], "uuid": "c26e41a6395546e1bdf9ee6602eb2e9f", "sample_count": 0}]}, "field_extraction_builder": {"idm:json": {"data_format": "json"}, "ipa:api": {"data_format": "json"}}, "global_settings_builder": {"global_settings": {"log_settings": {"log_level": "DEBUG"}, "credential_settings": [], "customized_settings": [{"required": true, "name": "base_url", "label": "IPA Server URL", "default_value": "", "placeholder": "", "help_string": "Example: https://idm.example.com", "type": "text", "format_type": "text", "value": "https://idm.ledezmatechnologies.com"}, {"required": false, "name": "verify_ssl", "label": "Verify SSL", "default_value": true, "help_string": "", "type": "checkbox", "format_type": "checkbox", "value": true}, {"required": false, "name": "ca_cert_path", "label": "CA Cert Path (optional)", "default_value": "", "placeholder": "", "help_string": "Example:/etc/ipa/ca.crt", "type": "text", "format_type": "text", "value": "/opt/splunk/etc/apps/TA-ipa/local/ipa-ca.crt"}]}}, "sourcetype_builder": {"idm:json": {"metadata": {"event_count": 0, "data_input_name": "idm", "extractions_count": 0, "cims_count": 0}}}, "validation": {"validators": ["best_practice_validation", "data_model_mapping_validation", "field_extract_validation", "app_cert_validation"], "status": "job_started", "validation_id": "v_1762220955_62"}}